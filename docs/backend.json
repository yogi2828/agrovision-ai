{
  "entities": {
    "User": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "User",
      "type": "object",
      "description": "Represents a user in the AgroVision AI system.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the user.",
          "format": "uuid"
        },
        "name": {
          "type": "string",
          "description": "The user's full name."
        },
        "email": {
          "type": "string",
          "description": "The user's email address.",
          "format": "email"
        },
        "preferredLanguage": {
          "type": "string",
          "description": "The user's preferred language for the application.",
          "format": "language-code"
        },
        "voiceEnabled": {
          "type": "boolean",
          "description": "Indicates whether voice input/output is enabled for the user."
        }
      },
      "required": [
        "id",
        "name",
        "email",
        "preferredLanguage",
        "voiceEnabled"
      ]
    },
    "DiseaseHistory": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "DiseaseHistory",
      "type": "object",
      "description": "Represents a record of a plant disease detection analysis performed by a user.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the disease history record."
        },
        "userId": {
          "type": "string",
          "description": "Reference to the User who performed the analysis. (Relationship: User 1:N DiseaseHistory)"
        },
        "plantName": {
          "type": "string",
          "description": "The name of the plant analyzed."
        },
        "disease": {
          "type": "string",
          "description": "The detected disease name."
        },
        "treatment": {
          "type": "string",
          "description": "Recommended treatment for the detected disease."
        },
        "timestamp": {
          "type": "string",
          "description": "Timestamp of when the analysis was performed.",
          "format": "date-time"
        }
      },
      "required": [
        "id",
        "userId",
        "plantName",
        "disease",
        "treatment",
        "timestamp"
      ]
    },
    "ChatHistory": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "ChatHistory",
      "type": "object",
      "description": "Represents a record of a conversation between a user and the AI chatbot.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the chat history message."
        },
        "userId": {
          "type": "string",
          "description": "Reference to the User who participated in the chat. (Relationship: User 1:N ChatHistory)"
        },
        "userMessage": {
          "type": "string",
          "description": "The message sent by the user."
        },
        "aiResponse": {
          "type": "string",
          "description": "The response generated by the AI chatbot."
        },
        "language": {
          "type": "string",
          "description": "The language used during the conversation.",
          "format": "language-code"
        },
        "timestamp": {
          "type": "string",
          "description": "Timestamp of when the message was sent.",
          "format": "date-time"
        }
      },
      "required": [
        "id",
        "userId",
        "userMessage",
        "aiResponse",
        "language",
        "timestamp"
      ]
    }
  },
  "auth": {
    "providers": [
      "password",
      "anonymous"
    ]
  },
  "firestore": {
    "structure": [
      {
        "path": "/users/{userId}",
        "definition": {
          "entityName": "User",
          "schema": {
            "$ref": "#/backend/entities/User"
          },
          "description": "Stores user profile information. The userId parameter corresponds to the Firebase Auth UID. Includes user's id, name, email, preferredLanguage, and voiceEnabled settings.",
          "params": [
            {
              "name": "userId",
              "description": "The unique identifier for the user, matching the Firebase Auth UID."
            }
          ]
        }
      },
      {
        "path": "/users/{userId}/diseaseHistory/{diseaseHistoryId}",
        "definition": {
          "entityName": "DiseaseHistory",
          "schema": {
            "$ref": "#/backend/entities/DiseaseHistory"
          },
          "description": "Stores disease detection history records for each user. Includes plantName, disease, treatment, and timestamp.",
          "params": [
            {
              "name": "userId",
              "description": "The unique identifier for the user, matching the Firebase Auth UID."
            },
            {
              "name": "diseaseHistoryId",
              "description": "The unique identifier for the disease history record."
            }
          ]
        }
      },
      {
        "path": "/users/{userId}/chatHistory/{chatHistoryId}",
        "definition": {
          "entityName": "ChatHistory",
          "schema": {
            "$ref": "#/backend/entities/ChatHistory"
          },
          "description": "Stores chat history messages between the user and the AI chatbot. Includes userMessage, aiResponse, language, and timestamp.",
          "params": [
            {
              "name": "userId",
              "description": "The unique identifier for the user, matching the Firebase Auth UID."
            },
            {
              "name": "chatHistoryId",
              "description": "The unique identifier for the chat history message."
            }
          ]
        }
      }
    ],
    "reasoning": "The Firestore data structure is designed to ensure security, scalability, and ease of debugging, in accordance with the defined principles.  Authorization Independence is achieved by structuring data to avoid hierarchical `get()` calls in security rules. Path-based ownership is implemented for user-specific data, such as DiseaseHistory and ChatHistory, enabling simple and efficient security rules based solely on `request.auth.uid`. This eliminates reliance on parent document data for authorization. Structural Segregation is achieved by storing user-specific data in separate collections under the `/users/{userId}` path. This ensures that all documents within these collections share the same security requirements, simplifying rules and preventing unintended access. Since the app does not use collaborative data access modeling is less applicable. The design supports QAPs by segregating data based on ownership, which allows for secure list operations without filtering based on document content. Data Clarity is ensured through explicit field naming and data typing as defined in the entity schemas, making the data model predictable and maintainable. Invariants such as ownership and timestamps can be easily enforced within the security rules using this structure."
  }
}