(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[128],{1847:(e,t,a)=>{"use strict";a.r(t),a.d(t,{default:()=>U});var s=a(5155),r=a(2115),i=a(285),n=a(157);let l=(0,n.A)("Camera",[["path",{d:"M14.5 4h-5L7 7H4a2 2 0 0 0-2 2v9a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2V9a2 2 0 0 0-2-2h-3l-2.5-3z",key:"1tc9qg"}],["circle",{cx:"12",cy:"13",r:"3",key:"1vg3eu"}]]);var o=a(5318);let c=(0,n.A)("ScanSearch",[["path",{d:"M3 7V5a2 2 0 0 1 2-2h2",key:"aa7l1z"}],["path",{d:"M17 3h2a2 2 0 0 1 2 2v2",key:"4qcy5o"}],["path",{d:"M21 17v2a2 2 0 0 1-2 2h-2",key:"6vwrx8"}],["path",{d:"M7 21H5a2 2 0 0 1-2-2v-2",key:"ioqczr"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}],["path",{d:"m16 16-1.9-1.9",key:"1dq9hf"}]]),d=(0,n.A)("Upload",[["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["polyline",{points:"17 8 12 3 7 8",key:"t8dd8p"}],["line",{x1:"12",x2:"12",y1:"3",y2:"15",key:"widbto"}]]);var u=a(6695),m=a(7481);function h(e){let{onDiagnose:t,loading:a}=e,[n,h]=(0,r.useState)(null),[p,f]=(0,r.useState)(!1),[x,v]=(0,r.useState)(null),g=(0,r.useRef)(null),y=(0,r.useRef)(null),{toast:j}=(0,m.dj)(),N=async()=>{f(!0)};(0,r.useEffect)(()=>{if(p)return(async()=>{if(!navigator.mediaDevices||!navigator.mediaDevices.getUserMedia){j({variant:"destructive",title:"Camera Not Supported",description:"Your browser does not support camera access. Try uploading a file instead."}),f(!1),v(!1);return}try{let e=await navigator.mediaDevices.getUserMedia({video:{facingMode:"environment"}});v(!0),g.current&&(g.current.srcObject=e)}catch(e){console.error("Error accessing camera:",e),v(!1),j({variant:"destructive",title:"Camera Access Denied",description:"Please enable camera permissions in your browser settings."}),f(!1)}})(),()=>{var e;(null==(e=g.current)?void 0:e.srcObject)&&g.current.srcObject.getTracks().forEach(e=>e.stop())}},[p,j]);let w=(0,r.useCallback)(()=>{var e;(null==(e=g.current)?void 0:e.srcObject)&&g.current.srcObject.getTracks().forEach(e=>e.stop()),f(!1)},[]);return p?(0,s.jsx)(u.Zp,{children:(0,s.jsxs)(u.Wu,{className:"p-4 text-center",children:[(0,s.jsx)("video",{ref:g,autoPlay:!0,playsInline:!0,muted:!0,className:"w-full rounded-md aspect-video object-cover bg-muted"}),(0,s.jsx)("canvas",{ref:y,className:"hidden"}),(0,s.jsxs)("div",{className:"flex justify-center gap-4 mt-4",children:[(0,s.jsxs)(i.$,{onClick:()=>{if(g.current&&y.current){let e=g.current,t=y.current;t.width=e.videoWidth,t.height=e.videoHeight;let a=t.getContext("2d");a&&(a.drawImage(e,0,0,e.videoWidth,e.videoHeight),h(t.toDataURL("image/jpeg"))),w()}},children:[(0,s.jsx)(l,{className:"mr-2 h-4 w-4"})," Capture"]}),(0,s.jsxs)(i.$,{variant:"outline",onClick:w,children:[(0,s.jsx)(o.A,{className:"mr-2 h-4 w-4"})," Cancel"]})]})]})}):(0,s.jsx)(u.Zp,{className:"border-2 border-dashed border-primary/50",children:(0,s.jsx)(u.Wu,{className:"p-4 text-center flex flex-col items-center justify-center min-h-[400px]",children:n?(0,s.jsxs)("div",{className:"relative w-full flex flex-col items-center",children:[(0,s.jsx)("img",{src:n,alt:"Plant preview",className:"max-h-80 rounded-lg shadow-md"}),(0,s.jsx)(i.$,{variant:"destructive",size:"icon",className:"absolute -top-2 -right-2 rounded-full h-8 w-8 z-10",onClick:()=>{h(null)},children:(0,s.jsx)(o.A,{className:"h-4 w-4"})}),(0,s.jsxs)(i.$,{onClick:()=>{n&&t(n)},disabled:a,size:"lg",className:"mt-6 w-full max-w-xs",children:[(0,s.jsx)(c,{className:"mr-2"}),"Analyze Plant - Get Treatment"]})]}):(0,s.jsxs)("div",{className:"space-y-6 max-w-md",children:[(0,s.jsx)("h2",{className:"text-2xl font-semibold font-headline",children:"Get Started"}),(0,s.jsxs)("div",{className:"flex flex-col sm:flex-row gap-4",children:[(0,s.jsx)(i.$,{asChild:!0,className:"flex-1 cursor-pointer",size:"lg",children:(0,s.jsxs)("label",{children:[(0,s.jsx)(d,{className:"mr-2"}),"Upload from Gallery",(0,s.jsx)("input",{type:"file",accept:"image/*",className:"sr-only",onChange:e=>{var t;let a=null==(t=e.target.files)?void 0:t[0];if(a){let e=new FileReader;e.onload=e=>{var t;h(null==(t=e.target)?void 0:t.result)},e.readAsDataURL(a)}}})]})}),(0,s.jsxs)(i.$,{onClick:N,className:"flex-1",size:"lg",variant:"secondary",children:[(0,s.jsx)(l,{className:"mr-2"}),"Use Camera"]})]}),(0,s.jsx)("p",{className:"text-xs text-muted-foreground px-4",children:"For best results, use a clear, well-lit photo of the affected area. Ensure the leaf or symptom is in focus."})]})})})}var p=a(2270),f=a(4477);let x=(0,f.createServerReference)("40ab7530b1f56cbf6b3a4601d4c0dfc06504c380bd",f.callServer,void 0,f.findSourceMapURL,"diagnosePlantHealth"),v=(0,n.A)("Terminal",[["polyline",{points:"4 17 10 11 4 5",key:"akl6gq"}],["line",{x1:"12",x2:"20",y1:"19",y2:"19",key:"q2wloq"}]]),g=(0,n.A)("Sparkles",[["path",{d:"M9.937 15.5A2 2 0 0 0 8.5 14.063l-6.135-1.582a.5.5 0 0 1 0-.962L8.5 9.936A2 2 0 0 0 9.937 8.5l1.582-6.135a.5.5 0 0 1 .963 0L14.063 8.5A2 2 0 0 0 15.5 9.937l6.135 1.581a.5.5 0 0 1 0 .964L15.5 14.063a2 2 0 0 0-1.437 1.437l-1.582 6.135a.5.5 0 0 1-.963 0z",key:"4pj2yx"}],["path",{d:"M20 3v4",key:"1olli1"}],["path",{d:"M22 5h-4",key:"1gvqau"}],["path",{d:"M4 17v2",key:"vumght"}],["path",{d:"M5 18H3",key:"zchphs"}]]);var y=a(172),j=a(5365),N=a(8666),w=a(8437),b=a(6633),S=a(9875),k=a(1978),A=a(869),E=a(2885),M=a(845),T=a(1508);class C extends r.Component{getSnapshotBeforeUpdate(e){let t=this.props.childRef.current;if(t&&e.isPresent&&!this.props.isPresent){let e=this.props.sizeRef.current;e.height=t.offsetHeight||0,e.width=t.offsetWidth||0,e.top=t.offsetTop,e.left=t.offsetLeft}return null}componentDidUpdate(){}render(){return this.props.children}}function P(e){let{children:t,isPresent:a}=e,i=(0,r.useId)(),n=(0,r.useRef)(null),l=(0,r.useRef)({width:0,height:0,top:0,left:0}),{nonce:o}=(0,r.useContext)(T.Q);return(0,r.useInsertionEffect)(()=>{let{width:e,height:t,top:s,left:r}=l.current;if(a||!n.current||!e||!t)return;n.current.dataset.motionPopId=i;let c=document.createElement("style");return o&&(c.nonce=o),document.head.appendChild(c),c.sheet&&c.sheet.insertRule('\n          [data-motion-pop-id="'.concat(i,'"] {\n            position: absolute !important;\n            width: ').concat(e,"px !important;\n            height: ").concat(t,"px !important;\n            top: ").concat(s,"px !important;\n            left: ").concat(r,"px !important;\n          }\n        ")),()=>{document.head.removeChild(c)}},[a]),(0,s.jsx)(C,{isPresent:a,childRef:n,sizeRef:l,children:r.cloneElement(t,{ref:n})})}let R=e=>{let{children:t,initial:a,isPresent:i,onExitComplete:n,custom:l,presenceAffectsLayout:o,mode:c}=e,d=(0,E.M)(_),u=(0,r.useId)(),m=(0,r.useCallback)(e=>{for(let t of(d.set(e,!0),d.values()))if(!t)return;n&&n()},[d,n]),h=(0,r.useMemo)(()=>({id:u,initial:a,isPresent:i,custom:l,onExitComplete:m,register:e=>(d.set(e,!1),()=>d.delete(e))}),o?[Math.random(),m]:[i,m]);return(0,r.useMemo)(()=>{d.forEach((e,t)=>d.set(t,!1))},[i]),r.useEffect(()=>{i||d.size||!n||n()},[i]),"popLayout"===c&&(t=(0,s.jsx)(P,{isPresent:i,children:t})),(0,s.jsx)(M.t.Provider,{value:h,children:t})};function _(){return new Map}var O=a(2082);let D=e=>e.key||"";function I(e){let t=[];return r.Children.forEach(e,e=>{(0,r.isValidElement)(e)&&t.push(e)}),t}var z=a(7494);let L=e=>{let{children:t,custom:a,initial:i=!0,onExitComplete:n,presenceAffectsLayout:l=!0,mode:o="sync",propagate:c=!1}=e,[d,u]=(0,O.xQ)(c),m=(0,r.useMemo)(()=>I(t),[t]),h=c&&!d?[]:m.map(D),p=(0,r.useRef)(!0),f=(0,r.useRef)(m),x=(0,E.M)(()=>new Map),[v,g]=(0,r.useState)(m),[y,j]=(0,r.useState)(m);(0,z.E)(()=>{p.current=!1,f.current=m;for(let e=0;e<y.length;e++){let t=D(y[e]);h.includes(t)?x.delete(t):!0!==x.get(t)&&x.set(t,!1)}},[y,h.length,h.join("-")]);let N=[];if(m!==v){let e=[...m];for(let t=0;t<y.length;t++){let a=y[t],s=D(a);h.includes(s)||(e.splice(t,0,a),N.push(a))}"wait"===o&&N.length&&(e=N),j(I(e)),g(m);return}let{forceRender:w}=(0,r.useContext)(A.L);return(0,s.jsx)(s.Fragment,{children:y.map(e=>{let t=D(e),r=(!c||!!d)&&(m===y||h.includes(t));return(0,s.jsx)(R,{isPresent:r,initial:(!p.current||!!i)&&void 0,custom:r?void 0:a,presenceAffectsLayout:l,mode:o,onExitComplete:r?void 0:()=>{if(!x.has(t))return;x.set(t,!0);let e=!0;x.forEach(t=>{t||(e=!1)}),e&&(null==w||w(),j(f.current),c&&(null==u||u()),n&&n())},children:e},t)})})};function U(){let[e,t]=(0,r.useState)(null),[a,i]=(0,r.useState)(null),[n,l]=(0,r.useState)(!1),[o,c]=(0,r.useState)(null),{user:d}=(0,w.A)(),{toast:f}=(0,m.dj)(),{language:A}=(0,b.o)(),E=async e=>{t(e),l(!0),c(null),i(null);try{(0,S.$)("analyze_request",{language:A});let t=await x({photoDataUri:e,language:A});i(t)}catch(e){console.error(e),c("Failed to diagnose plant. The AI model might be busy or an error occurred. Please try again."),(0,S.$)("analyze_request_failed")}finally{l(!1)}},M=async()=>{if(!d||!a)return void f({variant:"destructive",title:"Error",description:"You must be logged in and have a diagnosis result to save."});try{await (0,N.wj)(d.uid,a),(0,S.$)("save_history",{plant:a.plantIdentification.commonName}),f({title:"Saved to My History",description:"You can view your saved diagnoses on the History page."})}catch(e){console.error(e),f({variant:"destructive",title:"Save Failed",description:"Could not save diagnosis to your history."})}};return(0,s.jsxs)(k.P.div,{className:"container mx-auto max-w-6xl",initial:{opacity:0},animate:{opacity:1},children:[(0,s.jsxs)("div",{className:"text-center mb-8",children:[(0,s.jsx)("h1",{className:"font-headline text-3xl md:text-4xl font-bold tracking-tight",children:"Plant Health Diagnosis"}),(0,s.jsx)("p",{className:"text-muted-foreground mt-2 max-w-2xl mx-auto",children:"Upload a photo or use your camera to get an instant AI-powered diagnosis."})]}),o&&(0,s.jsxs)(j.Fc,{variant:"destructive",className:"mb-4",children:[(0,s.jsx)(v,{className:"h-4 w-4"}),(0,s.jsx)(j.XL,{children:"Error"}),(0,s.jsx)(j.TN,{children:o})]}),(0,s.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-2 lg:gap-8",children:[(0,s.jsxs)("div",{className:"lg:order-1",children:[(0,s.jsxs)(L,{mode:"wait",children:[!a&&!n&&(0,s.jsx)(k.P.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},exit:{opacity:0,y:-20},children:(0,s.jsx)(h,{onDiagnose:E,loading:n})},"image-input"),n&&(0,s.jsx)(k.P.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},children:(0,s.jsx)(u.Zp,{children:(0,s.jsxs)(u.Wu,{className:"flex flex-col items-center justify-center gap-4 text-center p-8 rounded-lg min-h-[400px]",children:[(0,s.jsxs)("div",{className:"relative",children:[(0,s.jsx)(g,{className:"absolute -top-4 -right-4 h-8 w-8 text-primary animate-pulse"}),(0,s.jsx)(y.A,{className:"h-12 w-12 animate-spin text-primary"})]}),(0,s.jsx)("h2",{className:"text-xl font-semibold",children:"Analyzing Plant..."}),(0,s.jsx)("p",{className:"text-muted-foreground",children:"Our AI is checking leaf patterns and disease markers. This may take a moment."}),e&&(0,s.jsx)("img",{src:e,alt:"Plant for diagnosis",className:"mt-4 max-h-64 rounded-lg shadow-md"})]})})},"loading")]}),a&&(0,s.jsx)(L,{children:(0,s.jsx)(k.P.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},children:(0,s.jsx)(p.f,{result:a,image:e,onReset:()=>{t(null),i(null),c(null),l(!1)},onSave:M})},"result")})]}),(0,s.jsx)("div",{className:"lg:order-2 mt-8 lg:mt-0",children:!a&&!n&&(0,s.jsx)(k.P.div,{initial:{opacity:0},animate:{opacity:1},className:"mt-8 lg:mt-0",children:(0,s.jsx)(u.Zp,{children:(0,s.jsxs)(u.Wu,{className:"p-6 text-center flex flex-col items-center justify-center min-h-[400px]",children:[(0,s.jsx)(g,{className:"w-12 h-12 mx-auto text-primary mb-4"}),(0,s.jsx)("h3",{className:"text-xl font-semibold",children:"Awaiting Diagnosis"}),(0,s.jsx)("p",{className:"text-muted-foreground mt-2",children:"Your plant's health analysis will appear here once you upload an image and start the diagnosis."})]})})},"awaiting")})]})]})}},4477:(e,t,a)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),!function(e,t){for(var a in t)Object.defineProperty(e,a,{enumerable:!0,get:t[a]})}(t,{callServer:function(){return s.callServer},createServerReference:function(){return i},findSourceMapURL:function(){return r.findSourceMapURL}});let s=a(3806),r=a(1818),i=a(4979).createServerReference},5010:(e,t,a)=>{Promise.resolve().then(a.bind(a,1847))},5318:(e,t,a)=>{"use strict";a.d(t,{A:()=>s});let s=(0,a(157).A)("X",[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]])},5365:(e,t,a)=>{"use strict";a.d(t,{Fc:()=>o,TN:()=>d,XL:()=>c});var s=a(5155),r=a(2115),i=a(2085),n=a(9434);let l=(0,i.F)("relative w-full rounded-lg border p-4 [&>svg~*]:pl-7 [&>svg+div]:translate-y-[-3px] [&>svg]:absolute [&>svg]:left-4 [&>svg]:top-4 [&>svg]:text-foreground",{variants:{variant:{default:"bg-background text-foreground",destructive:"border-destructive/50 text-destructive dark:border-destructive [&>svg]:text-destructive"}},defaultVariants:{variant:"default"}}),o=r.forwardRef((e,t)=>{let{className:a,variant:r,...i}=e;return(0,s.jsx)("div",{ref:t,role:"alert",className:(0,n.cn)(l({variant:r}),a),...i})});o.displayName="Alert";let c=r.forwardRef((e,t)=>{let{className:a,...r}=e;return(0,s.jsx)("h5",{ref:t,className:(0,n.cn)("mb-1 font-medium leading-none tracking-tight",a),...r})});c.displayName="AlertTitle";let d=r.forwardRef((e,t)=>{let{className:a,...r}=e;return(0,s.jsx)("div",{ref:t,className:(0,n.cn)("text-sm [&_p]:leading-relaxed",a),...r})});d.displayName="AlertDescription"},6633:(e,t,a)=>{"use strict";a.d(t,{LanguageProvider:()=>n,o:()=>l});var s=a(5155),r=a(2115);let i=(0,r.createContext)(void 0);function n(e){let{children:t}=e,[a,n]=(0,r.useState)("en");return(0,s.jsx)(i.Provider,{value:{language:a,setLanguage:n},children:t})}function l(){let e=(0,r.useContext)(i);if(void 0===e)throw Error("useLanguage must be used within a LanguageProvider");return e}},7481:(e,t,a)=>{"use strict";a.d(t,{dj:()=>m});var s=a(2115);let r=0,i=new Map,n=e=>{if(i.has(e))return;let t=setTimeout(()=>{i.delete(e),d({type:"REMOVE_TOAST",toastId:e})},1e6);i.set(e,t)},l=(e,t)=>{switch(t.type){case"ADD_TOAST":return{...e,toasts:[t.toast,...e.toasts].slice(0,1)};case"UPDATE_TOAST":return{...e,toasts:e.toasts.map(e=>e.id===t.toast.id?{...e,...t.toast}:e)};case"DISMISS_TOAST":{let{toastId:a}=t;return a?n(a):e.toasts.forEach(e=>{n(e.id)}),{...e,toasts:e.toasts.map(e=>e.id===a||void 0===a?{...e,open:!1}:e)}}case"REMOVE_TOAST":if(void 0===t.toastId)return{...e,toasts:[]};return{...e,toasts:e.toasts.filter(e=>e.id!==t.toastId)}}},o=[],c={toasts:[]};function d(e){c=l(c,e),o.forEach(e=>{e(c)})}function u(e){let{...t}=e,a=(r=(r+1)%Number.MAX_SAFE_INTEGER).toString(),s=()=>d({type:"DISMISS_TOAST",toastId:a});return d({type:"ADD_TOAST",toast:{...t,id:a,open:!0,onOpenChange:e=>{e||s()}}}),{id:a,dismiss:s,update:e=>d({type:"UPDATE_TOAST",toast:{...e,id:a}})}}function m(){let[e,t]=s.useState(c);return s.useEffect(()=>(o.push(t),()=>{let e=o.indexOf(t);e>-1&&o.splice(e,1)}),[e]),{...e,toast:u,dismiss:e=>d({type:"DISMISS_TOAST",toastId:e})}}},9875:(e,t,a)=>{"use strict";a.d(t,{$:()=>i});var s=a(2201),r=a(6864);let i=async(e,t)=>{try{let a=await s.zS;a&&(0,r.$s)(a,e,t)}catch(e){console.error("Error logging analytics event:",e)}}}},e=>{var t=t=>e(e.s=t);e.O(0,[644,992,277,648,427,874,870,366,934,61,95,441,684,358],()=>t(5010)),_N_E=e.O()}]);